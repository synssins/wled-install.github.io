<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WLED Installation - Custom P4 Experimental</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    a { color: #0000EE; cursor: pointer; text-decoration: underline;}
    .custom-build { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white !important;
      font-weight: bold;
    }
    .hero {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 2rem;
      border-radius: 10px;
      margin-bottom: 2rem;
    }
  </style>
  <script type="module" src="https://unpkg.com/esp-web-tools@9.4.3/dist/web/install-button.js?module"></script>
</head>
<body>
<div class="container m-2 p-0">
  <div class="hero">
    <h2><b>WLED Custom Installer</b></h2>
    <p class="mb-0">Flash WLED P4 Experimental firmware to your ESP32 devices</p>
  </div>
  
  <small><div class="alert alert-info">This software is open source and provided "as is" without warranty. Experimental versions may contain bugs. Use at your own risk.</div></small>
  
  <h5>Installation Steps:</h5>
  <ol>
    <li>Connect your ESP32 board via USB port to your computer</li>
    <li>Select your board type and firmware version below</li>
    <li>Click "Install" and select the correct COM port 
      <button class="btn btn-secondary btn-sm" onclick="showComPortHelp()">No board found?</button>
    </li>
    <div id="comporthelp"></div>
    <li>Click "Install WLED" and wait for the installation to complete</li>
    <li>If installation stops at "Wrapping Up", you can safely interrupt it - the firmware is already installed</li>
  </ol>

  <div class="form-floating mb-3">
    <select id="software_version" onchange="selectSoftware();" class="form-select">
      
      <optgroup label="‚≠ê CUSTOM BUILD - P4 Experimental">
        <option class="custom-build" 
                data-manifest="manifest-custom.json" 
                data-download="firmware/firmware.bin"
                selected>
          ESP32 - P4 Experimental (troyhacks/WLED) - RECOMMENDED
        </option>
      </optgroup>

      <optgroup label="Standard WLED - Stable v0.15.1">
        <option data-manifest="https://wled-install.github.io/manifest_dir/manifest_Standard_version_0_15_1_WLED_0.15.1_ESP32.json">
          ESP32 (4MB Flash, Audio Reactive)
        </option>
        <option data-manifest="https://wled-install.github.io/manifest_dir/manifest_Standard_version_0_15_1_WLED_0.15.1_ESP32-C3.json">
          ESP32-C3 (4MB Flash)
        </option>
        <option data-manifest="https://wled-install.github.io/manifest_dir/manifest_Standard_version_0_15_1_WLED_0.15.1_ESP32-S2.json">
          ESP32-S2 (4MB Flash, Audio Reactive)
        </option>
        <option data-manifest="https://wled-install.github.io/manifest_dir/manifest_Standard_version_0_15_1_WLED_0.15.1_ESP32-S3_8MB_opi.json">
          ESP32-S3 (8MB Flash, Audio Reactive)
        </option>
      </optgroup>

      <optgroup label="Standard WLED - v0.14.4">
        <option data-manifest="https://wled-install.github.io/manifest_dir/manifest_Standard_version_0_14_4_WLED_0.14.4_ESP32.json">
          ESP32 (4MB Flash)
        </option>
        <option data-manifest="https://wled-install.github.io/manifest_dir/manifest_Standard_version_0_14_4_WLED_0.14.4_ESP32_audioreactive.json">
          ESP32 (4MB Flash, Audio Reactive)
        </option>
      </optgroup>

    </select>
    <label for="software_version">Board Type / Firmware Version:</label>
  </div>

  <div id="warning-container" class="alert alert-warning" style="display:none;">
    <strong>‚ö†Ô∏è Experimental Build Warning</strong><br>
    This custom P4 experimental firmware is automatically compiled from: 
    <a href="https://github.com/troyhacks/WLED/tree/P4_experimental" target="_blank">troyhacks/WLED P4_experimental branch</a>
    <br>Use only if you understand the risks of experimental software.
    <button class="btn btn-primary mt-2" onclick="acceptWarning()">I Understand - Continue</button>
  </div>

  <div id="install-container" style="display:none;">
    <div class="d-grid gap-2 mb-3">
      <esp-web-install-button id="install_btn" manifest="manifest-custom.json">
        <button class="btn btn-primary btn-lg" slot="activate">
          üöÄ Install WLED to Device
        </button>
      </esp-web-install-button>
    </div>

    <div class="text-center mb-3">
      <a href="firmware/firmware.bin" class="btn btn-outline-secondary" id="download_btn">
        üì• Download Firmware Only (.bin file)
      </a>
    </div>
  </div>

  <hr>

  <div class="row">
    <div class="col-md-6">
      <h5>üîó Useful Resources:</h5>
      <ul>
        <li><a href="https://kno.wled.ge" target="_blank">WLED Official Documentation</a></li>
        <li><a href="https://wled-faq.github.io" target="_blank">WLED FAQ</a></li>
        <li><a href="https://wled-calculator.github.io" target="_blank">WLED Power Calculator</a></li>
        <li><a href="https://github.com/troyhacks/WLED/tree/P4_experimental" target="_blank">P4 Experimental Source Code</a></li>
        <li><a href="https://github.com/Aircoookie/WLED" target="_blank">Official WLED Repository</a></li>
      </ul>
    </div>
    <div class="col-md-6">
      <h5>‚ÑπÔ∏è About This Installer:</h5>
      <p>This custom installer provides easy access to the P4 experimental branch of WLED, which includes cutting-edge features and improvements.</p>
      <p><small>Firmware is automatically built weekly from the latest P4_experimental branch.</small></p>
    </div>
  </div>

  <hr>

  <div class="accordion" id="accordionHelp">
    <div class="accordion-item">
      <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDisclaimer">
          Legal Disclaimer
        </button>
      </h2>
      <div id="collapseDisclaimer" class="accordion-collapse collapse" data-bs-parent="#accordionHelp">
        <div class="accordion-body">
          <small>
            This is a custom WLED installer. Software is provided "AS IS" without warranty of any kind, express or implied. 
            By using this installer, you accept all risks associated with experimental firmware.
            The maintainer of this site is not responsible for any damage to your devices.
          </small>
        </div>
      </div>
    </div>
  </div>

  <footer class="text-center mt-4 mb-4">
    <small class="text-muted">
      WLED Project by Aircoookie ‚Ä¢ P4 Experimental by troyhacks ‚Ä¢ Installer customized for personal use
    </small>
  </footer>

</div>

<script>
function selectSoftware() {
  const select = document.getElementById('software_version');
  const option = select.options[select.selectedIndex];
  const manifest = option.dataset.manifest;
  const download = option.dataset.download;
  
  // Update manifest
  document.getElementById('install_btn').setAttribute('manifest', manifest);
  
  // Update download link
  if (download) {
    document.getElementById('download_btn').setAttribute('href', download);
  }
  
  // Show warning for custom build (first option)
  if (select.selectedIndex === 0) {
    document.getElementById('warning-container').style.display = 'block';
    document.getElementById('install-container').style.display = 'none';
  } else {
    document.getElementById('warning-container').style.display = 'none';
    document.getElementById('install-container').style.display = 'block';
  }
}

function acceptWarning() {
  document.getElementById('warning-container').style.display = 'none';
  document.getElementById('install-container').style.display = 'block';
}

function showComPortHelp() {
  const helpDiv = document.getElementById('comporthelp');
  if (helpDiv.innerHTML === '') {
    helpDiv.innerHTML = `
      <div class="alert alert-info mt-2">
        <strong>Troubleshooting:</strong>
        <ul class="mb-0">
          <li>Check that your USB cable supports data transfer (not just charging)</li>
          <li>You may need to install USB drivers for your ESP32 board:
            <ul>
              <li><a href="https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers" target="_blank">CP210x drivers</a> (small square chip)</li>
              <li><a href="http://www.wch-ic.com/downloads/CH341SER_EXE.html" target="_blank">CH34x drivers</a> (rectangular chip)</li>
            </ul>
          </li>
          <li>Try a different USB port</li>
          <li>Make sure no other program is using the COM port</li>
        </ul>
      </div>
    `;
  } else {
    helpDiv.innerHTML = '';
  }
}

// Check if browser supports Web Serial API
window.onload = function() {
  if (document.getElementById('install_btn').hasAttribute('install-unsupported')) {
    document.body.innerHTML = `
      <div class="container mt-5">
        <div class="alert alert-danger">
          <h4>Browser Not Supported</h4>
          <p>Your browser does not support USB installation via Web Serial API.</p>
          <p>Please use:</p>
          <ul>
            <li>Google Chrome (Desktop)</li>
            <li>Microsoft Edge</li>
            <li>Opera</li>
          </ul>
          <p>You can still <a href="firmware/firmware.bin">download the firmware</a> and use other flashing tools like esptool.py</p>
        </div>
      </div>
    `;
  }
  selectSoftware();
};
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
